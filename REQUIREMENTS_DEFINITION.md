# 営業AIポータル 改善要件定義書

## 1. 現状分析 (Current Status)

### 1.1 営業日報くん (Daily Reporter)
- **ステータス**: Phase 2 (プロンプト強化) および Phase 3 (UI機能) の主要機能が実装済み。
- **実装済み機能**:
    - **プロンプト最適化**: 農業用語辞書、製品カタログ、Few-shot学習の統合。
    - **エラーハンドリング**: リトライロジック、JSONフォールバック解析。
    - **UI機能**:
        - 履歴機能 (LocalStorage保存, UI表示)
        - フィードバック機能 (Good/Bad評価, UI実装)
        - コピー機能 (Markdown/Text切替)
        - 入力補助 (静的なTips表示)
        - ユーザー設定 (氏名・会社名の永続化)

### 1.2 その他エージェント
- **会議まとめくん (Meeting Recorder)**: 高度な録音機能（iOS対応）、Google Drive連携、セグメント分割処理などが実装済み。
    - **課題**: 話者分離（誰が話しているか）の識別機能が弱い。文字起こしプロンプトが簡易的。
- **空き時間検索くん (Calendar Finder)**: Google/Microsoftカレンダー連携、簡易パスワード保護が実装済み。
- **話題提案くん (AgriTalk)**: 基本的な検索機能が実装済み。

### 1.3 課題 (Issues)
- **データの永続性 (Critical)**:
    - 現状のログ機能 (`lib/utils/logger.ts`) やフィードバック保存 (`app/api/daily-report-feedback/route.ts`) が **ローカルファイルシステム (`fs`) に依存** しています。
    - Vercelなどのサーバーレス環境にデプロイした場合、これらのデータは **消失** します。
- **セキュリティ**:
    - `Calendar Finder` のパスワード保護がクライアントサイドでの判定 (`CORRECT_PASSWORD = "6501"`) になっており、セキュリティ上脆弱です。
- **UI/UX**:
    - `Daily Reporter` の入力補助が静的なテキスト表示のみで、実際の入力を支援する機能（クリックで挿入など）になっていません。

---

## 2. 改善要件 (Requirements for Improvements)

### 優先度 S: インフラ・基盤改善 (Phase 3.5)
**目的**: 本番環境でのデータ保全とセキュリティ確保

#### S-1. ログ・フィードバックのクラウド保存対応
- **現状**: `fs.appendFileSync` でローカルファイルに保存。
- **要件**:
    - 持続的なデータストアへの移行（Supabase, Firebase, または Vercel KVを推奨）。
    - 暫定対応として、Google Sheets APIを用いてスプレッドシートにログを追記する方法も可（既存のGoogle API設定を流用可能）。
- **対象**:
    - ユーザー利用ログ
    - 日報フィードバック (Good/Bad + コメント)

#### S-2. パスワード保護のサーバーサイド移行
- **現状**: クライアントサイドでの文字列比較。
- **要件**:
    - 環境変数 (`ACCESS_PASSWORD`) でパスワードを管理。
    - APIルート (`/api/auth/verify`) またはServer Actionで認証を行い、セッションクッキーを発行する仕組みに変更。

### 優先度 A: UI/UX 機能強化 (Phase 4)
**目的**: ユーザー効率の大幅な向上

#### A-1. クリック可能なテンプレート機能
- **現状**: 「入力のコツ」としてテキストが表示されているのみ。
- **要件**:
    - 「テンプレートを挿入」ボタン群を配置（例：「新規訪問」「クレーム対応」「定期フォロー」）。
    - ボタン押下で、入力エリアにプレースホルダーテキストを挿入。
    - 挿入時、すでに入力がある場合は上書き確認を行う。

#### A-2. 入力文字数のリアルタイム可視化と品質メーター
- **現状**: バリデーションエラー時のみフィードバック。
- **要件**:
    - 入力エリア下部に「文字数 / 推奨文字数」をリアルタイム表示。
    - 文字数に応じてインジケーターの色を変える（赤→黄→緑）。

### 優先度 B: 機能拡張 (Future)

#### B-1. 日報フィードバックの管理画面
- **要件**:
    - 収集したフィードバックを閲覧できる管理画面 (`/admin/feedback`)。
    - 要認証（Basic認証またはログイン）。

#### B-2. 会議サマリーの高度化 (Meeting Recorder)
- **現状**:
    - 文字起こしプロンプトが「日本語で文字起こし」のみと簡易的。
    - 話者分離（ダイアライゼーション）が実装されていないため、誰の発言か不明。
- **要件**:
    - **話者識別**: Gemini 2.0の機能またはプロンプトエンジニアリングで「話者A」「話者B」の分離を試みる。
    - **ビジネス特化プロンプト**: 「フィラー（えー、あの）の除去」「ビジネス用語の補正」を指示に含める。
    - **要約プロンプトの多様化**: 会議タイプ（商談、定例、ブレスト）を選択し、プロンプトを切り替える機能。

## 3. 次のアクションプラン

1.  **データ保存先の決定**: Vercel KV または Google Sheets どちらを採用するか決定。
2.  **ログ出力処理の改修**: `logger.ts` および `feedback/route.ts` の改修。
3.  **テンプレートUIの実装**: `Daily Reporter` へのボタン追加。
